import 'dart:math';
import 'dart:typed_data'; // Needed for Float32List
import 'package:tflite_flutter/tflite_flutter.dart';
import 'package:image/image.dart' as img;

class CurrencyVerifier {
  Interpreter? _interpreter;

  // ==========================================================
  // 1. THE GOLDEN DATABASE
  // ==========================================================
  final Map<String, List<double>> goldenVectors = {
  '100_back': [-0.04591, -0.13749, 0.06192, -0.02156, 0.01013, 0.02180, 0.00390, -0.05423, 0.09679, 0.14759, 0.01525, -0.14717, -0.01372, -0.00945, -0.00652, -0.00874, 0.17186, -0.01295, -0.01694, -0.05187, 0.01531, 0.09183, 0.07769, 0.03025, -0.09161, -0.06456, 0.11113, 0.09820, -0.04370, -0.00895, 0.04741, 0.03774, 0.09770, 0.03650, -0.00945, 0.09327, 0.08746, 0.06074, -0.10976, -0.01688, 0.14867, -0.13552, 0.18008, -0.04084, -0.09303, 0.11686, -0.07960, 0.00407, -0.06512, 0.16777, -0.05700, -0.03266, 0.07800, -0.07246, -0.05476, -0.04983, 0.07186, -0.12931, 0.06786, 0.09214, 0.08412, 0.03017, 0.02390, -0.06656, -0.09896, 0.06018, 0.04805, -0.13325, 0.11915, 0.09530, 0.01526, 0.05319, 0.00849, 0.04284, 0.06696, 0.10689, -0.08980, -0.08153, -0.04845, -0.02967, 0.16649, -0.07575, 0.05422, 0.03386, -0.22468, 0.06266, -0.09013, 0.07540, 0.01908, -0.02188, -0.06816, 0.07839, -0.01507, 0.06993, 0.02510, 0.01668, 0.17140, -0.10972, 0.01903, -0.05831, -0.18653, 0.01191, 0.06334, 0.11519, 0.12321, -0.10739, -0.02208, 0.07752, -0.03439, 0.08584, 0.14435, -0.09731, -0.07393, -0.00623, 0.01321, -0.05149, -0.04384, -0.08350, -0.06743, 0.17931, 0.06179, -0.14146, -0.21828, 0.17160, -0.07347, -0.12916, -0.06149, -0.10948],
  '100_front': [0.03732, 0.05049, -0.02355, -0.05205, -0.07654, -0.02144, -0.03242, -0.00200, 0.08364, -0.02955, -0.12790, -0.10138, -0.04645, -0.09209, 0.09053, -0.00450, 0.14954, -0.00814, -0.04052, -0.07137, -0.00810, 0.04176, 0.01681, -0.00802, 0.11445, 0.02372, 0.19493, 0.11426, 0.06312, -0.12877, 0.03963, 0.13077, -0.03765, 0.04075, -0.03235, -0.03940, -0.10282, -0.02980, -0.20155, 0.08070, 0.15938, 0.00243, 0.11844, -0.04308, -0.05496, 0.05554, 0.21036, 0.04928, -0.12338, 0.05595, 0.05948, -0.01685, 0.06088, -0.07665, -0.03412, -0.12592, 0.13067, -0.20958, -0.10201, -0.01424, -0.16280, -0.03967, -0.07231, -0.01412, -0.14084, 0.02979, -0.01075, -0.13256, 0.04204, 0.06969, -0.06232, -0.07145, 0.05343, 0.10693, -0.00999, -0.03915, -0.01623, -0.04440, -0.04866, -0.06636, 0.05756, -0.09131, 0.06177, -0.02527, -0.30415, 0.15494, -0.05417, -0.08632, 0.00133, -0.03159, 0.00735, -0.17846, -0.11327, 0.02802, 0.04543, -0.06269, 0.02421, 0.07656, 0.12790, 0.09162, -0.03046, 0.04944, -0.06772, 0.08928, -0.04314, 0.01030, -0.05440, 0.03264, 0.13692, 0.03004, 0.03711, -0.01908, -0.17537, 0.01270, 0.15027, -0.01538, 0.00917, -0.11124, -0.15239, 0.00674, 0.10504, 0.04688, -0.09359, -0.06732, 0.10029, -0.00275, 0.09625, 0.01630],
  '200_back': [-0.01617, -0.03347, -0.03909, -0.06216, 0.06973, 0.10909, 0.06271, -0.06884, 0.03174, 0.08320, -0.10013, -0.11272, 0.00988, 0.13393, 0.06502, 0.03218, 0.04567, 0.01700, 0.06743, 0.11797, -0.03151, 0.01912, 0.06658, 0.08228, 0.03840, -0.01729, 0.11821, -0.08557, -0.11601, 0.00005, -0.14407, -0.02246, 0.00194, 0.17411, 0.03378, -0.04598, 0.08641, 0.00478, -0.13859, -0.19366, 0.01066, -0.03656, 0.12322, -0.03265, -0.12957, 0.07868, -0.13140, 0.03454, -0.13766, 0.09204, 0.01221, -0.01931, 0.15744, 0.00124, 0.02748, 0.06528, 0.09906, -0.10449, 0.05765, -0.04527, 0.05059, -0.02484, 0.12217, 0.05322, -0.08883, 0.00754, 0.09007, -0.08864, 0.02071, -0.07545, 0.08766, -0.06989, -0.13332, -0.02397, 0.04285, 0.08263, -0.20831, -0.08556, -0.15365, -0.13377, 0.12005, -0.03530, 0.05087, 0.08596, -0.07020, -0.09685, 0.00266, -0.01139, 0.07111, -0.14592, 0.01757, 0.09799, 0.03850, -0.01856, -0.17922, 0.05652, 0.17426, 0.04233, 0.04449, 0.08507, -0.11740, -0.03578, -0.05092, 0.03682, 0.21992, 0.01913, 0.13011, 0.06350, 0.16717, 0.08930, 0.06195, -0.11895, -0.09175, -0.02620, -0.03716, 0.14913, -0.04904, -0.04222, -0.01996, 0.09262, 0.03586, -0.06732, -0.13447, 0.14334, -0.03191, 0.02503, -0.09804, -0.00714],
  '200_front': [0.05403, 0.07699, -0.02388, -0.08302, -0.08448, 0.05146, -0.16309, -0.10148, -0.01290, -0.01829, -0.14205, -0.09242, -0.01676, -0.07629, 0.06747, -0.04348, -0.05686, -0.09089, -0.11102, -0.07779, -0.02577, 0.05851, -0.04914, 0.03756, 0.09298, -0.01618, 0.14437, 0.11533, 0.03734, -0.17105, 0.04351, 0.11010, 0.01619, 0.08044, 0.02511, -0.10480, -0.07000, -0.01449, -0.11006, 0.00704, 0.08156, -0.05381, -0.03056, 0.01236, -0.02691, 0.01354, 0.06325, 0.07268, -0.04768, -0.04448, -0.00403, -0.09371, -0.07229, 0.00128, -0.00590, -0.12892, 0.08032, -0.03727, -0.15394, 0.04403, -0.18935, -0.01836, -0.03649, 0.06140, -0.03691, 0.13232, 0.04740, -0.03373, -0.01053, 0.00808, -0.00531, -0.13785, 0.02915, 0.20593, -0.09881, -0.09753, -0.07883, 0.00339, -0.07508, -0.13882, -0.02181, -0.04237, 0.01150, -0.12474, -0.16559, 0.09498, 0.04026, -0.10826, -0.04911, -0.01118, -0.04401, -0.22609, -0.11843, 0.08354, 0.06396, -0.05854, -0.01802, 0.07272, 0.17530, 0.18800, -0.06605, -0.00885, -0.05590, 0.11473, -0.09087, 0.09432, 0.03274, -0.05237, 0.19339, -0.04750, 0.09162, 0.02482, -0.02972, 0.10845, 0.06649, -0.03125, -0.00866, -0.16768, -0.21130, 0.00323, 0.05672, 0.15891, -0.04293, -0.07515, 0.10832, 0.08765, 0.05987, -0.06865],
  '500_back': [-0.03305, 0.01738, 0.04214, -0.02824, -0.06836, 0.03123, -0.07534, -0.07657, 0.02787, 0.12461, -0.17122, -0.21902, -0.00134, -0.00355, 0.08425, 0.02929, 0.08731, -0.06378, -0.07554, -0.11836, -0.07936, 0.06203, 0.04093, -0.02800, 0.07230, 0.02226, 0.13018, 0.07632, -0.00297, -0.18828, 0.05595, 0.08064, -0.05297, 0.13714, -0.07517, 0.01358, 0.00349, -0.09154, -0.14524, -0.00194, 0.21295, -0.09784, 0.07782, -0.00873, -0.14221, 0.02116, -0.01371, 0.01203, -0.15198, 0.13789, -0.05331, -0.10236, -0.12166, -0.00831, 0.00130, -0.07720, 0.18130, -0.12789, -0.02043, 0.06158, -0.06752, -0.02312, -0.02458, 0.10437, -0.06860, 0.09882, 0.13385, -0.07075, -0.03308, -0.03423, 0.14112, -0.07440, -0.09283, 0.09961, -0.08594, 0.04115, -0.05369, -0.19735, -0.13805, -0.13960, -0.03277, -0.06641, -0.02219, 0.00147, -0.14785, 0.09160, -0.04906, -0.05314, -0.04267, -0.11096, -0.07833, 0.00629, 0.04155, -0.01407, -0.08749, 0.02762, 0.02603, -0.01285, 0.10370, 0.10413, -0.10809, 0.02215, -0.11417, 0.12886, 0.06299, -0.02914, 0.02722, 0.03544, 0.15648, 0.03531, 0.13904, -0.06287, -0.10371, 0.04463, 0.05767, -0.06439, -0.00868, -0.06831, -0.11164, 0.13557, 0.05474, 0.01480, -0.09837, 0.14282, -0.05323, 0.06981, -0.10904, -0.02046],
  '500_front': [0.05923, 0.09242, -0.03370, -0.07132, -0.10447, 0.02345, -0.13487, -0.07331, -0.05414, -0.08865, -0.16270, -0.06918, -0.02161, -0.05652, 0.05039, -0.08104, -0.02541, -0.06611, -0.02911, -0.00617, -0.06826, 0.04162, -0.10882, 0.09050, 0.06790, -0.04863, 0.18101, 0.08148, -0.00890, -0.20680, -0.01656, 0.09667, 0.06112, 0.07303, 0.05448, -0.10515, 0.05298, 0.10107, -0.04045, -0.06479, 0.02988, -0.14404, -0.05629, -0.04142, 0.03042, -0.00676, -0.03628, 0.14649, 0.01560, -0.05627, -0.10542, -0.16002, 0.03448, 0.02439, -0.08160, -0.09984, 0.08824, 0.02282, -0.14976, -0.01674, -0.14897, 0.02106, -0.02441, 0.01598, -0.02668, 0.05331, 0.01536, -0.05521, 0.04195, 0.07602, -0.00817, -0.07973, -0.02888, 0.12396, -0.11235, 0.03754, -0.18473, -0.08551, -0.10181, -0.12508, 0.00083, 0.01409, -0.02205, -0.15763, -0.15998, 0.04389, 0.01355, -0.02048, -0.08208, -0.06128, -0.01616, -0.19899, -0.05685, 0.11408, 0.03123, -0.04017, 0.05961, 0.04005, 0.20471, 0.15511, -0.07492, -0.02177, 0.02646, 0.09824, 0.00098, 0.11892, 0.02831, -0.03284, 0.19157, -0.12673, 0.05448, -0.02694, 0.05084, 0.10582, 0.06348, -0.02617, -0.00947, -0.17960, -0.20778, 0.00861, 0.08539, 0.13979, -0.09250, -0.09874, 0.03589, 0.05475, 0.07325, -0.07226],
  '50_back': [-0.05998, -0.01595, -0.11099, 0.10857, 0.03319, 0.09306, 0.01311, -0.01657, 0.08675, 0.09262, -0.11797, -0.06531, 0.04942, 0.04097, 0.14366, 0.10214, 0.10276, -0.03076, -0.04479, 0.04451, -0.06074, -0.02166, 0.00981, -0.02150, 0.01062, 0.03631, 0.14467, 0.08137, 0.03789, -0.12261, 0.05961, -0.00250, 0.04671, 0.04753, 0.04235, 0.08038, 0.05256, -0.01155, -0.21684, -0.05934, 0.20719, 0.03185, 0.09813, -0.03058, -0.18686, -0.01131, 0.02551, -0.00006, -0.15457, 0.21337, 0.01873, -0.03828, 0.09294, -0.04933, 0.01471, 0.04232, 0.09567, -0.22825, 0.06890, 0.05922, 0.00373, -0.03296, 0.01800, 0.03517, -0.04766, -0.01383, 0.01241, -0.05025, 0.06729, -0.09250, -0.02591, -0.05690, -0.07312, 0.11260, -0.02200, 0.10093, -0.06294, -0.12462, -0.15217, -0.17491, 0.04999, -0.01338, -0.03251, -0.02624, -0.18228, 0.12663, 0.08349, -0.10629, -0.04170, -0.05535, -0.11190, 0.06039, 0.06557, 0.01062, -0.02543, 0.07897, 0.05939, 0.10290, 0.07576, -0.07086, -0.05979, -0.06495, -0.15633, 0.09160, 0.17174, -0.03472, -0.02861, 0.12536, 0.04707, 0.03939, 0.04554, -0.10777, -0.16734, -0.03740, 0.12740, 0.04935, 0.12261, -0.05077, -0.05427, 0.13314, 0.00817, -0.07191, -0.19622, 0.11612, -0.03670, -0.03066, -0.06789, 0.03708],
  '50_front': [0.12673, 0.06671, -0.04059, -0.05660, -0.15190, -0.01091, 0.00836, -0.06896, 0.05646, -0.09385, -0.16520, -0.05569, -0.07376, -0.06951, 0.09776, 0.02311, 0.11887, -0.06935, 0.02011, -0.06280, -0.02638, 0.01898, -0.06460, -0.01913, 0.20569, 0.04991, 0.18026, 0.10251, 0.04190, -0.10097, 0.03378, 0.14368, -0.01645, 0.15349, -0.08044, 0.03463, -0.11009, -0.02380, -0.14009, 0.07402, 0.17172, 0.06314, 0.01583, -0.09465, -0.06051, 0.04865, 0.12786, 0.00159, -0.09124, 0.01560, -0.10173, -0.06900, 0.11108, -0.09839, -0.04709, -0.10469, 0.08352, -0.21302, -0.09403, -0.05232, -0.10404, -0.13346, -0.06343, -0.01833, -0.10345, -0.04593, -0.04502, -0.13788, -0.00760, 0.02868, -0.09767, -0.16691, -0.00627, -0.03972, -0.07921, 0.02533, -0.00225, -0.03335, -0.11386, -0.03268, 0.00407, 0.03121, 0.11107, 0.01762, -0.20530, 0.13404, 0.01540, -0.04983, 0.03259, 0.02769, 0.00226, -0.18391, -0.10943, -0.02564, -0.09931, -0.02490, -0.06850, 0.04388, 0.12483, 0.05335, 0.01909, -0.03915, -0.10814, 0.06751, -0.09942, 0.13168, -0.06510, -0.02623, 0.17710, -0.08884, 0.00859, -0.01605, -0.11847, -0.00181, 0.12873, 0.02725, -0.05307, -0.05510, -0.04515, 0.02248, 0.08715, 0.11495, -0.02446, -0.12169, 0.08075, -0.00636, 0.12139, -0.00657],
  'Gandhi_potrait': [0.19348, 0.08602, -0.04318, -0.13310, -0.01473, 0.10018, -0.07042, -0.15377, -0.08465, -0.16057, -0.05217, -0.05461, -0.04821, 0.05238, 0.04769, -0.09816, -0.13529, -0.13667, -0.01477, 0.06379, -0.02450, 0.03694, -0.22968, 0.10688, -0.01515, 0.02336, 0.01940, 0.05913, -0.00382, -0.20803, 0.06119, 0.09724, 0.15285, 0.09043, 0.02402, -0.19795, -0.03345, 0.09184, 0.05192, -0.11207, 0.00289, -0.01737, -0.17009, 0.09973, -0.00953, -0.00654, -0.07363, 0.08366, 0.00479, -0.11075, -0.05576, 0.01579, 0.01529, 0.02422, 0.02198, -0.05428, -0.02222, 0.02538, -0.06778, 0.06047, -0.05137, -0.01496, 0.04167, 0.09184, 0.00369, 0.09800, -0.01125, 0.02447, -0.04014, -0.16488, -0.15221, -0.13373, -0.06090, 0.07027, 0.04970, -0.01670, -0.04481, -0.04226, -0.02865, -0.06292, -0.11891, 0.07781, -0.03837, -0.19664, 0.05683, -0.00495, 0.12982, -0.11505, -0.00027, 0.07005, -0.12775, -0.11979, -0.09743, -0.07056, 0.01656, -0.06395, 0.03701, -0.01775, 0.13382, 0.12779, -0.09891, -0.07085, 0.04752, 0.07327, -0.09453, 0.08131, 0.13290, -0.03404, -0.01013, -0.10771, 0.08070, 0.10158, 0.03689, 0.15591, -0.03752, -0.01788, -0.02038, -0.08809, -0.13083, -0.04092, -0.00152, 0.10418, 0.06375, -0.14173, 0.10522, 0.00458, 0.05207, -0.09855],
  'ashoka_piller': [0.00658, 0.14439, -0.10774, -0.03239, 0.12747, -0.01118, -0.08478, -0.09934, -0.01759, 0.07756, -0.12493, -0.21633, 0.06304, -0.04388, -0.03848, -0.01138, -0.07453, -0.04686, -0.19543, 0.04411, -0.02496, 0.13180, -0.05615, -0.04077, -0.08921, 0.09026, 0.09843, 0.04701, -0.05728, 0.09332, -0.02487, 0.00293, 0.18193, 0.08080, 0.05525, -0.15695, 0.06184, -0.00957, -0.09384, -0.04130, 0.04563, -0.06439, -0.10002, 0.05246, 0.05695, -0.08581, -0.14476, -0.00007, 0.16618, 0.12492, 0.17827, 0.05053, -0.01815, -0.05297, 0.11203, -0.04683, 0.02385, -0.03714, -0.06812, 0.13035, 0.12914, 0.11586, -0.01716, 0.11002, -0.05137, 0.03999, 0.05125, 0.03190, -0.00617, -0.19350, 0.01745, -0.14217, 0.03977, 0.19181, 0.12281, 0.04389, 0.10541, -0.02519, 0.02028, -0.07892, 0.07143, -0.00323, -0.00218, -0.12004, -0.08151, -0.05459, -0.18891, -0.01139, -0.05891, 0.04942, -0.13080, -0.08209, 0.10300, -0.10113, 0.10685, -0.10380, 0.00452, 0.06656, -0.12292, 0.03708, 0.04688, -0.07007, -0.03726, -0.06599, -0.06651, -0.06701, -0.11311, -0.08249, -0.03181, 0.00065, 0.07291, 0.01816, 0.03751, -0.00322, 0.09232, -0.02483, 0.04534, -0.05723, -0.14642, 0.10644, -0.08796, 0.03876, 0.11711, 0.03125, 0.12921, 0.00750, 0.02236, 0.12437],
  'bleed_lines': [0.09076, 0.18109, 0.01202, -0.00087, 0.02913, -0.07744, 0.13121, 0.00459, 0.13298, -0.11605, 0.13055, 0.05897, -0.00579, -0.04649, -0.06438, 0.08028, 0.23218, 0.18706, 0.20240, 0.03100, 0.05465, 0.06311, 0.09714, -0.07747, 0.00305, -0.00176, -0.08996, 0.00304, -0.01129, 0.02102, 0.04591, -0.08650, -0.09093, -0.07012, -0.08441, -0.04296, 0.04622, -0.11362, -0.04548, 0.02195, -0.02873, -0.07294, 0.08637, -0.06278, -0.06735, -0.08692, -0.06687, -0.00903, 0.00094, -0.04611, -0.18683, 0.08312, 0.21433, 0.11451, 0.00737, -0.01228, -0.03627, 0.10847, 0.16278, -0.04008, 0.09712, 0.04215, -0.12468, 0.09357, -0.02524, -0.05226, -0.10743, 0.14420, -0.05878, 0.08078, 0.09249, 0.01311, -0.20716, -0.10608, 0.08108, 0.07884, 0.03964, 0.03206, 0.08211, -0.01088, -0.01311, -0.04717, 0.11239, 0.09091, 0.03103, 0.01246, -0.02266, -0.05455, -0.03134, -0.15835, 0.07509, 0.15289, 0.11895, 0.08148, -0.08581, -0.09754, 0.16598, -0.04549, 0.04295, -0.04997, -0.09665, -0.03957, -0.01784, -0.05633, 0.03421, 0.02417, 0.03038, -0.00658, 0.01333, 0.11570, -0.13068, 0.02214, 0.00182, -0.10145, -0.00786, -0.01532, -0.02680, -0.08349, -0.06958, -0.05568, 0.12664, -0.04127, 0.11820, 0.17273, -0.00892, 0.03883, 0.14739, -0.01356],
  'color_chg_num': [0.01406, 0.00141, -0.13919, 0.06412, 0.01996, -0.03830, 0.19297, -0.13239, 0.01828, 0.01160, 0.04130, 0.06636, 0.01319, 0.01730, 0.03735, -0.01737, -0.12010, -0.04688, 0.06218, 0.10877, 0.03389, -0.06479, -0.02335, 0.07853, 0.04127, 0.00910, -0.03706, 0.02632, 0.04968, 0.00238, 0.07435, -0.03573, 0.05041, 0.06498, -0.03696, 0.00301, -0.07430, 0.04930, 0.09103, -0.07951, 0.12911, 0.04931, -0.18990, 0.06121, 0.02450, 0.00971, -0.07480, 0.04637, 0.02206, 0.04501, 0.11201, -0.03128, 0.09987, 0.04156, 0.06617, 0.03702, -0.07029, -0.09975, 0.00771, 0.10994, 0.09356, -0.00663, 0.10409, 0.12140, -0.00862, -0.18033, -0.11459, -0.09879, 0.16009, -0.12828, -0.19638, 0.02479, 0.04369, 0.14994, 0.17142, -0.08242, -0.04104, 0.04615, 0.02100, -0.17397, 0.16245, 0.09712, -0.03958, -0.14150, -0.01180, 0.09203, 0.04370, -0.02808, 0.09593, 0.06568, -0.09776, -0.10936, -0.01015, 0.05794, 0.10984, 0.03217, -0.02501, 0.02799, 0.22049, -0.14878, -0.01516, -0.17831, -0.12698, 0.01201, 0.11489, 0.09464, -0.07110, 0.04345, -0.14943, -0.07349, -0.10429, -0.04821, -0.01281, 0.09008, 0.13815, 0.01842, 0.08831, -0.10180, -0.01969, 0.11092, -0.02590, 0.02687, -0.05399, -0.13395, 0.16016, -0.01493, 0.00449, 0.10563],
  'denomination_back': [0.05511, 0.04698, -0.07114, -0.02626, 0.00465, -0.03932, 0.18116, -0.11180, 0.06729, 0.05796, 0.04837, 0.05603, -0.03037, 0.05601, 0.05235, -0.04224, 0.00699, 0.00262, 0.11565, 0.15145, 0.04554, -0.10661, 0.01332, 0.09408, 0.02947, 0.03251, -0.10473, 0.01333, -0.11733, 0.07216, 0.05171, -0.05984, -0.01115, 0.10457, -0.16785, 0.09991, -0.22804, 0.00827, -0.01373, -0.03270, 0.08647, 0.12940, -0.09275, 0.09347, -0.05755, 0.02912, 0.02951, 0.04371, -0.01874, -0.08483, 0.05793, 0.09267, -0.03284, 0.11775, -0.05258, -0.02765, -0.05171, -0.01285, -0.05131, 0.22705, 0.08205, 0.00451, 0.05149, 0.09173, -0.08453, -0.18830, -0.06754, -0.15289, 0.08610, -0.11371, -0.11355, 0.10626, 0.10203, 0.10276, 0.21127, -0.13849, -0.02322, 0.09341, -0.06923, 0.00399, 0.05849, -0.00299, 0.12287, -0.06065, -0.07922, 0.10145, 0.14064, -0.19705, 0.13884, 0.05393, -0.04434, -0.15940, 0.07833, 0.09545, 0.07122, 0.01796, 0.06790, 0.00066, 0.19069, -0.05969, 0.01740, -0.09795, -0.09839, 0.00372, 0.03521, 0.01983, -0.00643, 0.01600, -0.11780, 0.02193, -0.01312, -0.12321, 0.01297, 0.05619, 0.03471, -0.05435, -0.01082, 0.04558, 0.01661, -0.03752, -0.01403, -0.04549, 0.10679, 0.03626, 0.21068, -0.01633, -0.06800, 0.07920],
  'guarentee_clause': [0.00816, 0.01212, 0.11488, 0.01566, 0.10546, 0.14171, 0.12648, -0.26834, -0.11159, 0.02733, -0.06718, -0.04713, 0.11661, -0.04886, -0.11514, 0.15984, -0.15806, -0.16584, -0.08682, 0.01599, 0.14140, 0.21763, -0.04360, 0.12011, -0.05706, 0.01040, 0.16072, 0.05650, 0.09636, -0.01403, 0.04040, -0.12717, -0.04366, 0.07111, 0.14928, 0.13941, -0.00951, -0.11080, -0.08825, -0.00100, 0.05545, -0.00974, -0.02525, -0.01288, -0.01928, 0.03873, -0.02697, -0.08611, -0.05003, -0.00254, 0.05698, -0.06232, -0.03477, -0.06263, 0.07252, -0.03062, -0.05426, -0.07206, 0.09271, 0.05038, -0.05852, -0.18323, 0.01108, 0.02498, 0.03546, 0.02846, 0.04683, -0.15391, 0.03700, -0.12991, -0.13101, -0.04291, 0.07048, -0.00131, -0.02883, -0.13040, -0.00660, 0.12981, -0.08543, -0.19185, 0.08719, -0.05500, 0.12207, 0.03046, 0.04977, -0.05127, -0.10277, 0.05111, -0.01754, 0.04600, -0.12521, -0.09320, -0.08007, -0.04435, -0.01054, 0.11027, -0.03637, -0.07500, 0.11069, -0.11160, 0.01031, -0.08703, -0.05764, -0.05064, 0.06448, 0.03026, -0.01378, -0.01513, 0.03758, -0.02536, 0.15938, 0.06479, -0.15262, -0.00729, 0.02314, 0.13481, 0.10894, 0.00212, -0.01053, 0.09892, -0.12999, 0.11794, -0.08054, -0.00192, 0.00061, 0.02295, -0.04995, -0.01674],
  'language_panel': [-0.02746, 0.04078, 0.09761, 0.08112, 0.04743, 0.10290, 0.03806, -0.18640, -0.08945, 0.18937, 0.02276, -0.07146, 0.01481, 0.07254, -0.12173, 0.08394, -0.08243, 0.01074, 0.04627, 0.04452, -0.06962, 0.16332, 0.03112, -0.01948, -0.05141, -0.09338, 0.03868, 0.02018, 0.10383, -0.01551, 0.07209, -0.07432, -0.07058, 0.14247, 0.03627, 0.08081, 0.12721, -0.11991, 0.00323, 0.10014, 0.11811, -0.11121, 0.00140, 0.05221, -0.01868, -0.02233, -0.14610, -0.00615, 0.02009, 0.08149, -0.12258, 0.01818, -0.09188, 0.07380, -0.04524, -0.04517, 0.12242, 0.06765, 0.10966, 0.07606, -0.02950, 0.02435, 0.01795, 0.04429, -0.01985, 0.14476, 0.11258, -0.02558, -0.04720, 0.00829, 0.01231, 0.05861, -0.06344, -0.04370, -0.09905, -0.01856, -0.12817, 0.01076, -0.01221, -0.14729, 0.00003, -0.07541, 0.02045, 0.01236, 0.04494, -0.04987, -0.07805, 0.08005, -0.01589, -0.09381, -0.16130, 0.23971, -0.01559, 0.01310, -0.14948, 0.10666, 0.07033, -0.08834, -0.09190, -0.12474, -0.04079, -0.07450, 0.03129, 0.10511, 0.07919, 0.09010, -0.00156, -0.04052, 0.04897, 0.11198, 0.20727, -0.07657, 0.01050, 0.06707, -0.10641, 0.02710, -0.04790, -0.02872, 0.08796, 0.11864, -0.05918, -0.05345, -0.02484, 0.23065, -0.17215, 0.03402, -0.16586, -0.17137],
  'lined_number': [0.02636, 0.19481, -0.16150, -0.02247, 0.06781, -0.08268, -0.02438, 0.04238, -0.09752, -0.12577, -0.02229, -0.11164, -0.09423, -0.08453, -0.12746, 0.19703, 0.01371, -0.05145, -0.08881, 0.19015, 0.05811, 0.00513, 0.05895, 0.01338, 0.02500, 0.02655, 0.01130, 0.15235, -0.09116, 0.10094, 0.06014, 0.01001, -0.06044, 0.07543, 0.09023, -0.08670, -0.07264, -0.07137, -0.03268, 0.02860, 0.07682, -0.03511, 0.00660, -0.05242, 0.02764, -0.18824, -0.08781, -0.09311, 0.05309, -0.03696, 0.03882, 0.04963, 0.14587, -0.04909, 0.08031, -0.07136, 0.04725, -0.08439, -0.00151, 0.06107, 0.20467, 0.07908, 0.00310, 0.15908, 0.02827, -0.08371, -0.07011, -0.00491, -0.03621, -0.03195, -0.06819, -0.11319, 0.01677, -0.09783, 0.08655, 0.19867, 0.05999, -0.00380, 0.06825, -0.01414, 0.06463, 0.07379, 0.01469, 0.02054, -0.11488, -0.07661, -0.19991, 0.00638, -0.01938, 0.07813, -0.09877, 0.02969, 0.13140, -0.08699, 0.06337, -0.02825, 0.04933, 0.07623, -0.07898, -0.18873, 0.08663, 0.02373, -0.03131, -0.12451, -0.08239, -0.06896, -0.05722, 0.01756, -0.05200, -0.07289, 0.13395, 0.09556, -0.06337, -0.11648, 0.13083, -0.01325, 0.09656, -0.04991, -0.11149, 0.15107, -0.09828, 0.05843, 0.04218, 0.09830, 0.07715, -0.01563, 0.03979, 0.16739],
  'micro_text': [-0.05171, -0.01956, -0.04188, 0.11586, -0.00364, -0.05506, -0.13775, 0.15436, -0.09328, 0.11274, 0.07580, 0.00521, -0.12421, -0.08190, 0.13389, -0.03277, 0.04440, -0.11279, 0.02764, 0.08238, 0.05792, -0.11882, 0.10677, -0.00674, 0.17473, 0.00933, -0.05429, 0.12071, -0.05017, 0.02025, 0.05892, 0.06770, -0.09749, 0.15273, -0.10944, -0.16878, -0.15670, -0.00123, -0.08797, 0.15921, 0.14480, 0.02395, -0.02231, 0.02754, -0.04141, -0.09026, 0.02759, -0.02129, 0.01533, -0.14214, -0.03101, -0.07864, -0.14564, 0.10879, -0.13375, 0.02483, 0.21181, -0.02319, -0.10093, 0.06264, 0.11884, 0.14358, 0.09921, -0.01918, 0.02307, -0.00261, 0.07840, -0.01765, -0.02147, -0.06760, -0.06657, -0.02292, 0.06631, 0.01315, -0.01777, 0.08225, -0.01108, 0.02068, 0.03363, 0.01345, -0.08992, 0.02817, 0.04987, -0.03049, -0.11837, 0.01611, 0.08477, -0.05876, -0.00285, -0.02697, 0.04479, -0.28624, -0.05013, -0.13736, 0.18041, -0.06004, 0.01156, 0.03639, -0.02754, -0.00932, 0.08329, 0.06971, 0.07279, -0.02304, -0.12850, -0.08580, 0.14624, 0.00692, -0.03477, 0.00888, 0.16752, -0.03575, 0.09148, -0.01290, 0.14190, -0.01895, -0.01134, 0.11666, 0.06130, 0.07989, -0.06649, 0.14422, 0.06774, 0.10818, 0.08228, 0.03010, -0.03064, 0.01010],
  'monumental_portrait': [0.08063, -0.10605, 0.05698, -0.20344, 0.12195, 0.16710, -0.14442, 0.06230, 0.02627, -0.07368, 0.04837, -0.17505, -0.05986, 0.09983, 0.06042, -0.09035, 0.17829, -0.02804, 0.00629, 0.08571, 0.02358, 0.11409, -0.04856, 0.04321, 0.01260, -0.03721, 0.02029, -0.00414, -0.07260, 0.06223, -0.04015, -0.02306, -0.01115, 0.01874, -0.02313, -0.04267, 0.06688, -0.06488, -0.03018, -0.11576, -0.07308, -0.01104, 0.06665, -0.03744, -0.08345, 0.06194, -0.05904, -0.02406, -0.07846, 0.04082, 0.16985, 0.13880, 0.15149, -0.03932, 0.06758, 0.05106, -0.05282, 0.01864, -0.02500, 0.11234, 0.13351, -0.09842, -0.12297, 0.03874, 0.04371, -0.00350, -0.00536, -0.00336, 0.10800, -0.07741, 0.06244, -0.10593, -0.10835, -0.10032, 0.21228, 0.11392, 0.07647, -0.14520, -0.08881, -0.08327, -0.06762, -0.03288, 0.06579, 0.12568, -0.00570, -0.14824, -0.06603, -0.00105, -0.02689, -0.12031, 0.04565, 0.08525, 0.03756, -0.06705, 0.02262, -0.09502, 0.02060, -0.09211, -0.03792, -0.09987, 0.03426, 0.01282, -0.02677, 0.01474, 0.07657, -0.22357, -0.01933, 0.13494, 0.08577, 0.16979, 0.04308, 0.14571, -0.14355, -0.07868, -0.00750, 0.04904, 0.00960, 0.09649, -0.06157, 0.11875, -0.00090, -0.06380, -0.13409, 0.05683, 0.15448, 0.02763, 0.01754, 0.15146],
  'note_50_see_throug': [0.08417, 0.17567, -0.10933, -0.10698, 0.05750, -0.10935, -0.01280, -0.09001, -0.10088, -0.20947, 0.00042, 0.00849, -0.04366, -0.01244, -0.12655, 0.04267, -0.14536, -0.09410, -0.06667, 0.20072, -0.03072, -0.01447, -0.11347, 0.05424, -0.09807, 0.00958, -0.06962, 0.06027, -0.07603, -0.11025, 0.10897, -0.04655, 0.08037, 0.08541, 0.03725, -0.07545, 0.03541, 0.03912, 0.10156, -0.18163, 0.03634, -0.02906, -0.17101, 0.07395, 0.04161, -0.11291, -0.01479, 0.07679, 0.08465, -0.08784, 0.10373, 0.05418, 0.12515, 0.11462, 0.00508, -0.04283, -0.07578, 0.05878, 0.04399, 0.11809, 0.01218, 0.12022, 0.14610, 0.08138, 0.01735, -0.08707, -0.06084, -0.10216, 0.05522, -0.06599, -0.14691, -0.06051, 0.05104, 0.08490, 0.08660, 0.03538, -0.06043, 0.00859, -0.02352, -0.13216, 0.11101, 0.10074, -0.11257, -0.22245, -0.01507, -0.05907, -0.05082, -0.01868, 0.02718, 0.02431, -0.04458, 0.01011, 0.10461, 0.12038, 0.12811, 0.05156, 0.06115, 0.07378, 0.17442, -0.08304, 0.10623, -0.10129, 0.07115, 0.03800, 0.03881, 0.01321, -0.07191, -0.08693, -0.04203, -0.14262, 0.07194, 0.06356, 0.01562, 0.05542, 0.10795, 0.03780, 0.02708, -0.07763, -0.17125, 0.06894, -0.05356, 0.06289, 0.02773, -0.07941, 0.08359, 0.04613, -0.01480, 0.11421],
  'res_bank': [-0.07665, -0.15297, 0.12202, -0.00195, -0.02839, 0.11944, -0.06446, -0.03961, -0.00855, 0.05714, 0.08139, -0.16634, 0.04281, -0.03745, -0.03756, 0.10225, 0.03451, 0.03219, -0.02180, -0.11633, -0.15547, 0.22477, 0.08263, -0.02864, -0.04511, 0.00263, 0.01313, 0.09884, 0.20259, -0.03304, 0.06186, 0.03158, -0.05646, 0.01242, 0.07196, 0.06187, 0.07090, -0.24059, -0.11978, 0.06309, 0.05197, 0.05240, 0.07270, 0.06228, -0.07269, -0.00345, 0.11102, -0.10955, -0.11646, 0.08078, 0.07644, -0.06938, -0.18862, 0.05709, 0.13975, -0.00840, 0.02611, -0.10593, 0.11616, 0.05065, -0.17968, -0.14901, -0.11900, 0.01205, -0.04226, 0.11207, 0.04142, 0.04234, -0.12956, -0.00680, 0.07381, -0.07513, 0.00034, 0.07584, -0.06009, -0.10472, 0.06511, 0.05410, -0.06470, -0.19940, -0.05946, -0.08000, 0.14941, 0.01619, -0.03916, 0.05958, -0.02584, -0.05625, -0.12150, -0.10096, 0.03483, 0.04169, -0.02084, -0.07137, -0.01310, 0.01520, -0.09955, -0.03862, -0.09199, 0.00249, -0.02397, -0.06955, -0.14299, 0.08359, -0.05389, -0.02486, -0.01494, 0.03989, 0.08346, 0.16621, -0.02371, 0.09065, -0.22167, -0.04101, 0.04155, -0.04523, 0.00911, 0.05567, 0.07648, 0.09925, -0.03672, 0.02254, 0.00068, 0.12755, 0.07058, 0.03945, -0.07414, -0.05899],
  'security_thread': [-0.14257, 0.02332, 0.04149, 0.03480, -0.00125, -0.08096, -0.12442, -0.03888, 0.03367, -0.02764, -0.03923, -0.16000, 0.02229, -0.23765, 0.02332, -0.01896, 0.00019, 0.05194, -0.10766, -0.05517, -0.06779, 0.25884, 0.03358, 0.00055, -0.09492, -0.01447, 0.15245, -0.05425, 0.17945, -0.10283, -0.01974, 0.01992, 0.11755, 0.03090, 0.05389, -0.07751, 0.05592, -0.15852, -0.10114, 0.02297, 0.07489, -0.00728, -0.03766, 0.11662, 0.01854, 0.01254, 0.01545, -0.03650, -0.08287, 0.08639, 0.03656, -0.08008, -0.18199, 0.11415, 0.17498, -0.16553, 0.06455, -0.05309, 0.03337, 0.03293, -0.04888, -0.12963, -0.13379, -0.03614, -0.04580, 0.06112, 0.06008, 0.01072, -0.16074, -0.05915, 0.06201, -0.00447, 0.06691, 0.13351, -0.06128, -0.05640, 0.09128, -0.02158, 0.06701, -0.11705, -0.02307, -0.08579, -0.08868, -0.02455, -0.01572, 0.05810, -0.13498, 0.02699, -0.20904, -0.18882, -0.05255, -0.04167, 0.01831, -0.13282, 0.06570, 0.00073, -0.06539, -0.02252, -0.04596, 0.10769, -0.06051, -0.04742, -0.11353, 0.08948, -0.13021, 0.09194, 0.00135, 0.04019, 0.06490, 0.05621, -0.14697, 0.06691, -0.16206, 0.01844, 0.03190, -0.10158, 0.14273, -0.12068, -0.05800, -0.00543, 0.06767, 0.04447, 0.04536, -0.02085, 0.04233, -0.00291, 0.01958, 0.01006],
  'see_through_reg': [-0.03916, 0.17023, -0.11831, 0.10731, 0.01534, -0.06016, -0.13561, 0.02694, -0.01080, -0.02597, -0.00680, -0.20146, -0.15393, -0.01370, -0.05138, 0.12035, 0.03921, -0.02166, 0.00903, 0.17241, -0.11029, -0.06036, 0.00055, -0.03414, -0.07998, -0.05002, 0.01968, 0.10158, 0.11794, -0.06819, 0.07867, 0.11217, 0.00370, 0.14537, 0.08395, -0.04772, 0.01554, 0.05174, -0.04287, -0.05273, 0.12748, -0.03808, 0.08895, 0.07147, -0.01265, -0.06481, -0.03864, -0.01194, -0.11105, 0.00230, -0.05637, -0.04345, 0.04237, 0.05223, -0.07897, -0.02338, 0.20090, -0.05760, 0.08215, 0.05467, 0.06644, 0.11960, -0.03111, 0.04723, -0.07857, -0.02160, 0.04971, -0.06257, -0.02975, 0.10050, 0.06193, 0.01774, -0.06476, 0.02217, -0.04430, 0.24547, -0.17523, -0.17284, 0.07674, -0.04300, 0.03141, 0.10890, -0.14762, -0.16266, -0.12952, 0.15481, -0.13076, 0.04076, 0.08909, -0.13553, -0.02162, 0.14565, 0.08000, -0.06844, -0.04775, 0.00474, 0.06808, 0.10639, 0.05894, -0.07752, 0.02310, -0.06501, 0.07556, 0.16212, 0.01109, -0.07303, -0.07735, 0.13032, -0.07199, 0.00786, -0.04259, -0.03628, -0.10787, -0.07540, 0.07205, -0.07366, 0.06470, -0.04542, -0.06546, 0.13946, 0.08592, -0.09341, -0.02038, 0.09669, -0.12689, -0.09645, 0.01434, 0.01844],
  'serial_number': [-0.07549, -0.00752, -0.04662, -0.06255, 0.01407, 0.01808, 0.04444, -0.19685, -0.05248, -0.11938, -0.01490, -0.06189, -0.04792, -0.03012, -0.04928, 0.03379, -0.10979, 0.05098, 0.01996, 0.11047, -0.07876, 0.09079, -0.01615, 0.12170, -0.11141, -0.10538, -0.13491, 0.01417, -0.01291, -0.06825, 0.09750, -0.00618, -0.08250, 0.14954, 0.09942, 0.14167, -0.05547, -0.01799, 0.00165, -0.09301, -0.00794, 0.01031, -0.08722, 0.19892, -0.11810, -0.04943, 0.14131, -0.01110, -0.15943, -0.07312, 0.13532, -0.00551, -0.07913, 0.15891, 0.03429, -0.07432, -0.07617, 0.02567, 0.08967, 0.20109, -0.15004, -0.14114, -0.02010, -0.00761, -0.05602, 0.00860, -0.07701, -0.10356, -0.09939, -0.02268, -0.09462, 0.08202, 0.08569, 0.08091, 0.02483, -0.10727, -0.14534, 0.12220, -0.08742, -0.06998, -0.10225, -0.01857, -0.00827, -0.15963, -0.08652, 0.03292, 0.09133, -0.17237, -0.06251, 0.04945, 0.00154, 0.04942, 0.11958, 0.08661, 0.09302, 0.11500, 0.02992, 0.08063, 0.09439, 0.00381, 0.01329, -0.02643, -0.08901, 0.15719, -0.01546, 0.11936, -0.00908, 0.01720, -0.01620, 0.01125, -0.04013, 0.04498, -0.17058, 0.05904, -0.02853, -0.12810, -0.03876, 0.02319, -0.08122, -0.01233, 0.09948, -0.11292, 0.07634, 0.02621, 0.17480, 0.07498, -0.11790, -0.05760],
  'swatch_bharath': [0.00229, 0.12993, 0.02244, -0.00017, -0.06951, 0.03664, 0.18354, -0.15186, 0.00051, 0.01310, 0.13474, 0.07602, -0.00052, 0.09445, -0.03175, 0.22619, -0.14192, 0.00871, 0.09105, 0.20614, 0.05352, 0.07859, 0.02996, 0.18889, -0.07689, -0.07644, -0.00272, 0.04535, -0.07958, 0.10540, -0.06129, -0.13740, 0.00288, 0.05274, 0.04591, 0.11408, -0.10837, 0.03779, -0.05109, -0.08156, 0.08976, -0.02064, 0.03511, 0.08587, -0.01037, -0.00186, -0.03507, 0.05527, -0.10561, -0.07306, 0.02160, 0.06332, 0.05697, 0.18207, -0.02346, -0.05209, -0.12314, -0.00780, 0.12410, 0.20243, -0.08156, -0.14863, 0.08446, 0.12522, 0.13326, -0.06558, -0.13011, -0.17045, -0.00070, -0.08393, -0.19259, 0.01656, 0.04907, -0.08803, 0.13207, -0.02151, -0.08588, 0.12773, 0.06980, -0.08166, 0.08958, 0.04238, 0.02561, -0.10387, -0.03000, -0.08686, 0.01589, -0.04190, -0.08628, 0.13101, -0.04451, 0.03300, 0.04219, 0.08718, 0.03696, 0.04248, 0.11332, -0.02838, 0.17087, -0.01819, -0.04951, -0.05242, 0.01681, -0.00274, 0.11871, 0.07747, -0.01287, 0.10491, -0.05388, 0.03607, 0.10074, 0.03896, -0.09602, 0.01231, -0.05595, -0.05871, 0.05888, -0.04495, 0.02415, -0.04757, -0.09411, 0.08674, -0.02826, 0.06566, -0.02778, -0.00974, -0.13051, -0.10583],
  'white_number': [-0.02309, 0.10239, -0.05742, -0.11811, -0.02659, -0.07022, 0.00930, -0.13474, -0.02279, -0.14137, -0.05570, 0.04520, 0.04395, -0.09012, -0.05036, 0.02111, -0.14575, 0.01619, -0.09161, 0.25609, 0.05206, 0.12240, -0.02668, 0.14465, -0.07950, 0.00826, 0.04672, 0.05649, -0.08464, -0.01463, 0.01529, -0.10403, -0.01097, 0.06427, 0.02994, 0.07023, -0.15380, -0.03109, 0.03346, -0.03475, 0.17221, -0.05588, -0.21799, 0.19126, -0.00478, 0.02523, 0.00714, -0.02939, 0.02269, 0.00187, 0.05929, 0.05861, 0.04619, 0.09406, 0.10020, -0.14198, -0.05999, 0.01791, 0.00006, 0.25049, 0.02704, -0.00961, 0.06557, 0.09930, 0.06731, -0.12401, -0.08617, -0.14095, 0.04293, -0.06219, -0.16186, 0.07486, 0.09022, 0.00023, 0.13560, -0.06882, -0.07719, 0.12051, -0.00505, -0.04545, -0.00583, -0.08721, -0.11987, -0.01203, -0.02244, -0.05461, -0.10896, -0.01004, -0.05394, 0.01843, -0.02011, -0.01888, 0.11957, 0.04873, 0.16729, 0.12577, -0.01726, 0.04121, 0.19289, -0.11632, 0.10630, -0.04262, -0.03471, 0.04635, 0.01057, 0.02042, -0.05921, -0.06868, 0.03128, -0.10981, 0.09921, 0.14148, -0.08984, 0.07561, 0.04954, -0.10296, 0.03500, -0.09245, -0.03441, -0.01344, -0.04177, 0.05175, 0.00705, -0.11462, 0.18088, 0.00003, 0.00026, 0.09268],

  };

  // 2. THRESHOLD SETTING
  // Based on your test: 0.55 (Match) vs 10.0 (Fake)
  // We set a safe middle ground.
  final double threshold = 0.8; 

  Future<void> loadModel() async {
    try {
      _interpreter = await Interpreter.fromAsset('assets/verifier.tflite');
      print("Verifier Model loaded successfully ✅");
    } catch (e) {
      print("Error loading Verifier model: $e ❌");
    }
  }

  // This function is called by the main app when YOLO finds a box
  bool verifyFeature(img.Image fullFrame, List<int> bbox, String featureName) {
    if (_interpreter == null) {
      print("Verifier not loaded yet!");
      return false;
    }

    // 1. CHECK: Do we have a reference for this feature?
    if (!goldenVectors.containsKey(featureName)) {
      // If YOLO finds 'tree' but we don't verify trees, just say it's valid (or ignore)
      print("No golden vector for $featureName - Skipping verification.");
      return true; 
    }

    // 2. SAFE CROP (Prevent Crashes)
    int x = bbox[0];
    int y = bbox[1];
    int w = bbox[2];
    int h = bbox[3];

    // Ensure we don't crop outside the image
    if (x < 0) x = 0;
    if (y < 0) y = 0;
    if (x + w > fullFrame.width) w = fullFrame.width - x;
    if (y + h > fullFrame.height) h = fullFrame.height - y;
    if (w < 10 || h < 10) return false; // Too small to verify

    // 3. PROCESS IMAGE (Exact same as Python)
    // Crop -> Resize 128x128 -> Raw Pixels (0-255)
    img.Image crop = img.copyCrop(fullFrame, x: x, y: y, width: w, height: h);
    img.Image resized = img.copyResize(crop, width: 128, height: 128);
    
    // Prepare Input Tensor [1, 128, 128, 3]
    var input = _imageToFloat32List(resized);
    
    // Prepare Output Tensor [1, 128]
    var output = List.filled(1 * 128, 0.0).reshape([1, 128]);

    // 4. RUN INFERENCE
    _interpreter!.run(input, output);
    List<double> rawVector = List<double>.from(output[0]);

    // 5. NORMALIZE (The "Squash" Step) - Critical!
    List<double> liveVector = _normalize(rawVector);
    List<double> goldenVector = goldenVectors[featureName]!;

    // 6. COMPARE
    double distance = _euclideanDistance(liveVector, goldenVector);
    
    print("Verifying $featureName || Dist: ${distance.toStringAsFixed(4)}");

    // 7. DECISION
    if (distance < threshold) {
      return true; // ✅ Genuine
    } else {
      return false; // ❌ Fake
    }
  }

  // --- MATH HELPERS ---

  List<double> _normalize(List<double> vector) {
    double sumSq = 0.0;
    for (var val in vector) sumSq += val * val;
    double norm = sqrt(sumSq);
    if (norm == 0) return vector; // Avoid divide by zero
    return vector.map((e) => e / norm).toList();
  }

  double _euclideanDistance(List<double> v1, List<double> v2) {
    double sum = 0.0;
    for (int i = 0; i < v1.length; i++) {
      sum += pow((v1[i] - v2[i]), 2);
    }
    return sqrt(sum);
  }

  List<List<List<List<double>>>> _imageToFloat32List(img.Image image) {
    var converted = List.generate(
      1, (i) => List.generate(
        128, (y) => List.generate(
          128, (x) {
            var pixel = image.getPixel(x, y);
            // EFFICIENTNET V2 uses RAW 0-255. Do NOT divide by 255.0 here.
            return [pixel.r.toDouble(), pixel.g.toDouble(), pixel.b.toDouble()];
          }
        )
      )
    );
    return converted;
  }
}